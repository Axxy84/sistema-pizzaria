{% load static %}

<!-- Simple Pedido Card Component for Testing -->
<div class="bg-white overflow-hidden shadow rounded-lg hover:shadow-md transition-shadow">
    <div class="px-4 py-5 sm:p-6">
        <!-- Header -->
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center">
                <div class="ml-3">
                    <h3 class="text-lg font-medium text-gray-900">
                        Pedido #{{ pedido.numero }}
                    </h3>
                    <p class="text-sm text-gray-500">
                        {{ pedido.criado_em|date:"H:i" }}
                    </p>
                </div>
            </div>
            
            <!-- Status Badge -->
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                üü° {{ pedido.get_status_display }}
            </span>
        </div>
        
        <!-- Cliente -->
        <div class="mb-3">
            <div class="flex items-center text-sm text-gray-600">
                <svg class="mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                <span class="font-medium">{{ pedido.cliente.nome }}</span>
                <span class="mx-2">‚Ä¢</span>
                <span>{{ pedido.cliente.telefone }}</span>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="flex items-center justify-between">
            <div class="text-right">
                <p class="text-lg font-semibold text-gray-900">
                    R$ {{ pedido.total|floatformat:2 }}
                </p>
            </div>
        </div>
        
        <!-- Status Buttons -->
        <div class="mt-4 border-t border-gray-200 pt-4">
            <div class="flex flex-wrap gap-2 items-center justify-between">
                <!-- Status Buttons -->
                <div class="flex flex-wrap gap-2">
                    <!-- Recebido -->
                    <button onclick="changeStatusSimple({{ pedido.pk }}, 'recebido', this)"
                            {% if pedido.status == 'recebido' %}disabled{% endif %}
                            class="inline-flex items-center px-3 py-1.5 border text-sm font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500
                                   {% if pedido.status == 'recebido' %}bg-blue-100 text-blue-800 border-blue-300 cursor-default
                                   {% else %}bg-white text-blue-700 border-blue-300 hover:bg-blue-50{% endif %}">
                        <span class="mr-1">üìã</span>
                        <span class="hidden md:inline">Recebido</span>
                    </button>
                    
                    <!-- Preparando -->
                    <button onclick="changeStatusSimple({{ pedido.pk }}, 'preparando', this)"
                            {% if pedido.status == 'preparando' %}disabled{% endif %}
                            class="inline-flex items-center px-3 py-1.5 border text-sm font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500
                                   {% if pedido.status == 'preparando' %}bg-yellow-100 text-yellow-800 border-yellow-300 cursor-default
                                   {% else %}bg-white text-yellow-700 border-yellow-300 hover:bg-yellow-50{% endif %}">
                        <span class="mr-1">üü°</span>
                        <span class="hidden md:inline">Preparando</span>
                    </button>
                    
                    <!-- Saindo -->
                    <button onclick="changeStatusSimple({{ pedido.pk }}, 'saindo', this)"
                            {% if pedido.status == 'saindo' %}disabled{% endif %}
                            class="inline-flex items-center px-3 py-1.5 border text-sm font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500
                                   {% if pedido.status == 'saindo' %}bg-orange-100 text-orange-800 border-orange-300 cursor-default
                                   {% else %}bg-white text-orange-700 border-orange-300 hover:bg-orange-50{% endif %}">
                        <span class="mr-1">üü†</span>
                        <span class="hidden md:inline">Saindo</span>
                    </button>
                    
                    <!-- Entregue -->
                    <button onclick="changeStatusSimple({{ pedido.pk }}, 'entregue', this)"
                            {% if pedido.status == 'entregue' %}disabled{% endif %}
                            class="inline-flex items-center px-3 py-1.5 border text-sm font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500
                                   {% if pedido.status == 'entregue' %}bg-green-100 text-green-800 border-green-300 cursor-default
                                   {% else %}bg-white text-green-700 border-green-300 hover:bg-green-50{% endif %}">
                        <span class="mr-1">‚úÖ</span>
                        <span class="hidden md:inline">Entregue</span>
                    </button>
                    
                    <!-- Cancelar -->
                    {% if pedido.status not in 'entregue,cancelado' %}
                    <button onclick="changeStatusSimple({{ pedido.pk }}, 'cancelado', this)"
                            {% if pedido.status == 'cancelado' %}disabled{% endif %}
                            class="inline-flex items-center px-3 py-1.5 border text-sm font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500
                                   {% if pedido.status == 'cancelado' %}bg-red-100 text-red-800 border-red-300 cursor-default
                                   {% else %}bg-white text-red-700 border-red-300 hover:bg-red-50{% endif %}">
                        <span class="mr-1">‚ùå</span>
                        <span class="hidden md:inline">Cancelar</span>
                    </button>
                    {% endif %}
                </div>
                
                <!-- Ver Detalhes -->
                <div>
                    <a href="{% url 'pedidos:pedido_detail' pedido.pk %}"
                       class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        <span class="mr-1">üëÅÔ∏è</span>
                        Ver
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function changeStatusSimple(pedidoId, newStatus, buttonElement) {
    // Verificar se o bot√£o est√° desabilitado
    if (buttonElement && buttonElement.disabled) {
        return;
    }
    
    // Confirmar altera√ß√£o
    const statusName = getStatusName(newStatus);
    if (!confirm(`Deseja alterar o status do pedido para "${statusName}"?`)) {
        return;
    }
    
    // Desabilitar bot√£o temporariamente
    if (buttonElement) {
        buttonElement.disabled = true;
        buttonElement.textContent = 'Alterando...';
    }
    
    // Criar formul√°rio e submeter
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/pedidos/${pedidoId}/status/`;
    form.style.display = 'none';
    
    // CSRF token
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
    if (csrfToken) {
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'csrfmiddlewaretoken';
        csrfInput.value = csrfToken.value;
        form.appendChild(csrfInput);
    }
    
    // Status input
    const statusInput = document.createElement('input');
    statusInput.type = 'hidden';
    statusInput.name = 'status';
    statusInput.value = newStatus;
    form.appendChild(statusInput);
    
    // Adicionar ao DOM e submeter
    document.body.appendChild(form);
    form.submit();
}

function getStatusName(status) {
    const statusNames = {
        'recebido': 'Recebido',
        'preparando': 'Preparando', 
        'saindo': 'Saindo',
        'entregue': 'Entregue',
        'cancelado': 'Cancelado'
    };
    return statusNames[status] || status;
}
</script>